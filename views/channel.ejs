<!-- views/channel.ejs -->
<!doctype html>
<html>
<head>
	<title>IoT Minds Channel</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js" />
	<script type="text/javascript" src="/js/chart_controller.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="/">IoT Minds</a>
			</div>
			<div class="navbar-content">
				<ul class="nav navbar-nav navbar-left">
					<li><a href="/profile">Channels</a></li>
					<li><a href="#">Documentation</a></li>
					<li><a href="#">Support</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="/logout">Logout</a>     				
					</ul>    			
				</div>
			</div>
		</nav>
		<div class="container">
			<div class="row">
				<!-- HEADER -->
				<div class="col-sm-12">
					<div style="padding-top: 5px; padding-bottom: 25px;" align="center" class="well">
						<h3><%= channel_name %></h3>
						<h5>Channel ID: <span><%= channel_id%></span></h5>
						<h5>Created At: <span><%= created_at%></span></h5>
					</div>
				</div>
				<div class="col-sm-12">
					<ul class="nav nav-tabs">
						<li class="active"><a data-toggle="tab" href="#home">Dashboard</a></li>
						<li><a data-toggle="tab" href="#create_component">Create New Component</a></li>
						<li><a data-toggle="tab" href="#statistics">Statistics</a></li>
						<li><a data-toggle="tab" href="#api_keys">API Keys</a></li>
					</ul>
				</div>
				<div class="tab-content">
					<div id="home" class="tab-pane fade in active">
						<div style="margin-top: 25px;" class="col-sm-12">
							<% components.forEach(function(component){ %>
							<div class="col-md-4">
								<div class="thumbnail">
									<canvas id="<%=component.id%>"></canvas>
									<div class="caption">
										<h3><%= component.name %></h3>
										<h5>API Key : <%= component.api_key %></h5>
									</div>
									<%= component.api_key %>
								</div>
							</div>
							<% }); %>
						</div>						
					</div>
					<!-- COMPONENT LISTING AREA-->
					<div id="create_component" class="tab-pane fade">
						<div class="col-sm-6 col-sm-offset-3">
							<h1><span class="fa fa-sign-in"></span> Create a new Component</h1>
							<form action="/channels/<%= channel_id%>/new_component" method="post">
								<div class="form-group">
									<label>Component Name</label>
									<input type="text" class="form-control" name="name">
								</div>

								<button type="submit" class="btn btn-success btn-lg">Create</button>
							</form>
							<hr>
						</div>
					</div>
					<div id="statistics" class="tab-pane fade">
						Statistics is going here please wait
					</div>

					<div id="api_keys" class="tab-pane fade">
						<table class="table">
							<thead>
								<tr>
									<th> Component Name </th>
									<th> API Key </th>
									<th> Regenerate New Key</th>
								</tr>
							</thead>
							<tbody>
								<% components.forEach(function(component){%>

								<tr>
									<td><%=component.name%></td>
									<td><%=component.api_key%></td>
									<td><button class="btn btn-success">Regenerate</button>
								</tr>

								<% }) %>
							</tbody>
						</table>
					</div>

					<script type="text/javascript">
						<% components.forEach(function (component) { %>
							var tmp
							$.ajax({
								'async': false,
								'url': "http://localhost:8080/channels/components/<%=component.id%>",
								'type': "GET",
								'success': function (data) {
									tmp = data
								}
							})

							var chartData = {
								type: "line",
								data:{
									labels: tmp,
									datasets:[{
										data : tmp,
										label : "<%=component.name%>",
										borderColor: "rgba(54, 162, 235, 0.4)",
										backgroundColor : "rgba(54, 162, 235, 0.2)"
									}]

								}
							}
							var ctx = document.getElementById("<%=component.id%>").getContext('2d')
							var chartArea = new Chart(ctx,chartData)

							<%})%>

						</script>

					</div>
				</body>
				</html>
